<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Umeyka - –ü—Ä–æ—Å—Ç–æ–π —Å—Ç–∞—Ä—Ç</title>
  <style>
    /* –û–ß–ï–ù–¨ –ü–†–û–°–¢–´–ï –°–¢–ò–õ–ò - —á—Ç–æ–±—ã —Ç–æ—á–Ω–æ —Ä–∞–±–æ—Ç–∞–ª–æ */
    body {
      margin: 0;
      padding: 20px;
      font-family: Arial, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      color: white;
      text-align: center;
    }
    
    .container {
      max-width: 400px;
      margin: 0 auto;
      padding: 20px;
    }
    
    .logo {
      font-size: 60px;
      margin: 20px 0;
    }
    
    h1 {
      font-size: 28px;
      margin-bottom: 10px;
    }
    
    .subtitle {
      font-size: 16px;
      margin-bottom: 40px;
      opacity: 0.9;
    }
    
    /* –ë–û–õ–¨–®–ò–ï –ö–ù–û–ü–ö–ò */
    .big-button {
      display: block;
      width: 100%;
      padding: 25px;
      margin: 15px 0;
      border: none;
      border-radius: 15px;
      font-size: 20px;
      font-weight: bold;
      color: white;
      cursor: pointer;
      text-decoration: none;
      transition: all 0.3s;
    }
    
    .button-client {
      background: #48bb78;
    }
    
    .button-master {
      background: #ed8936;
    }
    
    .big-button:hover {
      transform: scale(1.05);
    }
    
    .hint {
      margin-top: 40px;
      font-size: 14px;
      opacity: 0.7;
    }
    
    /* –ü—Ä–æ—Å—Ç–∞—è —Ñ–æ—Ä–º–∞ */
    .simple-form {
      background: rgba(255,255,255,0.1);
      padding: 20px;
      border-radius: 15px;
      margin: 20px 0;
    }
    
    .simple-input {
      width: 100%;
      padding: 15px;
      margin: 10px 0;
      border: none;
      border-radius: 10px;
      font-size: 16px;
      box-sizing: border-box;
    }
    
    .skill-card {
      background: rgba(255,255,255,0.9);
      color: #333;
      padding: 15px;
      margin: 10px 0;
      border-radius: 10px;
      text-align: left;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="logo">üîß</div>
    <h1>Umeyka</h1>
    <p class="subtitle">–ù–∞–π–¥–∏ –º–∞—Å—Ç–µ—Ä–∞ –∏–ª–∏ —Å—Ç–∞–Ω—å –∏–º</p>
    
    <!-- –ë–û–õ–¨–®–ò–ï –ü–û–ù–Ø–¢–ù–´–ï –ö–ù–û–ü–ö–ò -->
    <button class="big-button button-client" onclick="showClientSection()">
      üîç –Ø –∏—â—É –º–∞—Å—Ç–µ—Ä–∞
    </button>
    
    <button class="big-button button-master" onclick="showMasterSection()">
      ‚ú® –Ø –º–∞—Å—Ç–µ—Ä
    </button>
    
    <!-- –°–µ–∫—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–∞ -->
    <div id="clientSection" style="display: none;">
      <div class="simple-form">
        <h2>üîé –ü–æ–∏—Å–∫ –º–∞—Å—Ç–µ—Ä–∞</h2>
        <input type="text" id="searchInput" class="simple-input" placeholder="–ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å?">
        <button class="big-button button-client" onclick="simpleSearch()">–ù–∞–π—Ç–∏</button>
        
        <div id="searchResults"></div>
      </div>
    </div>
    
    <!-- –°–µ–∫—Ü–∏—è –º–∞—Å—Ç–µ—Ä–∞ -->
    <div id="masterSection" style="display: none;">
      <div class="simple-form">
        <h2>üìù –î–æ–±–∞–≤–∏—Ç—å —É—Å–ª—É–≥—É</h2>
        <input type="text" id="skillInput" class="simple-input" placeholder="–ß—Ç–æ –≤—ã —É–º–µ–µ—Ç–µ?">
        <input type="text" id="experienceInput" class="simple-input" placeholder="–í–∞—à –æ–ø—ã—Ç">
        <input type="number" id="priceInput" class="simple-input" placeholder="–¶–µ–Ω–∞ –≤ —Ä—É–±–ª—è—Ö">
        <button class="big-button button-master" onclick="addSkill()">–î–æ–±–∞–≤–∏—Ç—å</button>
        
        <div id="mySkillsList"></div>
      </div>
    </div>
    
    <p class="hint">–í—ã–±–µ—Ä–∏—Ç–µ, —á—Ç–æ –≤—ã —Ö–æ—Ç–∏—Ç–µ —Å–¥–µ–ª–∞—Ç—å</p>
  </div>

  <script>
    // –ü–†–û–°–¢–û–ô JavaScript - —á—Ç–æ–±—ã —Ç–æ—á–Ω–æ —Ä–∞–±–æ—Ç–∞–ª–æ
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–µ–∫—Ü–∏—é –∫–ª–∏–µ–Ω—Ç–∞
    function showClientSection() {
      document.getElementById('clientSection').style.display = 'block';
      document.getElementById('masterSection').style.display = 'none';
      document.getElementById('searchResults').innerHTML = '<p>–í–≤–µ–¥–∏—Ç–µ —á—Ç–æ –∏—â–µ—Ç–µ –≤—ã—à–µ –∏ –Ω–∞–∂–º–∏—Ç–µ "–ù–∞–π—Ç–∏"</p>';
    }
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–µ–∫—Ü–∏—é –º–∞—Å—Ç–µ—Ä–∞
    function showMasterSection() {
      document.getElementById('masterSection').style.display = 'block';
      document.getElementById('clientSection').style.display = 'none';
      loadMySkills();
    }
    
    // –ü—Ä–æ—Å—Ç–æ–π –ø–æ–∏—Å–∫
    async function simpleSearch() {
      const query = document.getElementById('searchInput').value;
      if (!query) {
        alert('–í–≤–µ–¥–∏—Ç–µ —á—Ç–æ –∏—â–µ—Ç–µ!');
        return;
      }
      
      try {
        const response = await fetch(`/api/search-umeyka?query=${encodeURIComponent(query)}`);
        const skills = await response.json();
        
        const resultsDiv = document.getElementById('searchResults');
        
        if (skills.length > 0) {
          resultsDiv.innerHTML = '<h3>–ù–∞–π–¥–µ–Ω–æ:</h3>' + 
            skills.map(skill => `
              <div class="skill-card">
                <strong>${skill.skill}</strong><br>
                –û–ø—ã—Ç: ${skill.experience}<br>
                –¶–µ–Ω–∞: ${skill.price} —Ä—É–±.<br>
                <button onclick="contactMaster('${skill._id}', '${skill.skill}')" 
                        style="padding: 10px; margin-top: 10px; background: #667eea; color: white; border: none; border-radius: 5px; width: 100%;">
                  üí¨ –ù–∞–ø–∏—Å–∞—Ç—å –º–∞—Å—Ç–µ—Ä—É
                </button>
              </div>
            `).join('');
        } else {
          resultsDiv.innerHTML = '<p>–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥–æ–π –∑–∞–ø—Ä–æ—Å.</p>';
        }
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞:', error);
        resultsDiv.innerHTML = '<p>–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.</p>';
      }
    }
    
    // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —É–º–µ–Ω–∏—è
    async function addSkill() {
      const skill = document.getElementById('skillInput').value;
      const experience = document.getElementById('experienceInput').value;
      const price = document.getElementById('priceInput').value;
      
      if (!skill || !experience || !price) {
        alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è!');
        return;
      }
      
      try {
        // –ü—Ä–æ—Å—Ç–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –±–µ–∑ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏ –¥–ª—è –Ω–∞—á–∞–ª–∞
        const response = await fetch('/api/add-umeyka', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            skill,
            experience,
            price: parseFloat(price),
            location: { lat: 55.7558, lon: 37.6173 }, // –ú–æ—Å–∫–≤–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
            userId: 'simple-user'
          })
        });
        
        const data = await response.json();
        
        if (data.success) {
          alert('‚úÖ –£—Å–ª—É–≥–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞!');
          // –û—á–∏—â–∞–µ–º –ø–æ–ª—è
          document.getElementById('skillInput').value = '';
          document.getElementById('experienceInput').value = '';
          document.getElementById('priceInput').value = '';
          // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫
          loadMySkills();
        } else {
          alert('–û—à–∏–±–∫–∞: ' + (data.error || '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
        }
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è:', error);
        alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —É—Å–ª—É–≥–∏');
      }
    }
    
    // –ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–∏—Ö —É–º–µ–Ω–∏–π
    async function loadMySkills() {
      try {
        const response = await fetch('/api/my-umeyka/simple-user');
        const skills = await response.json();
        
        const skillsList = document.getElementById('mySkillsList');
        
        if (skills.length > 0) {
          skillsList.innerHTML = '<h3>–í–∞—à–∏ —É—Å–ª—É–≥–∏:</h3>' + 
            skills.map(skill => `
              <div class="skill-card">
                <strong>${skill.skill}</strong><br>
                –û–ø—ã—Ç: ${skill.experience}<br>
                –¶–µ–Ω–∞: ${skill.price} —Ä—É–±.
              </div>
            `).join('');
        } else {
          skillsList.innerHTML = '<p>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã—Ö —É—Å–ª—É–≥</p>';
        }
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:', error);
        skillsList.innerHTML = '<p>–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —É—Å–ª—É–≥</p>';
      }
    }
    
    // –ö–æ–Ω—Ç–∞–∫—Ç —Å –º–∞—Å—Ç–µ—Ä–æ–º
    function contactMaster(umeykaId, skillName) {
      alert(`üí¨ –í—ã —Ö–æ—Ç–∏—Ç–µ –Ω–∞–ø–∏—Å–∞—Ç—å –º–∞—Å—Ç–µ—Ä—É –ø–æ —É—Å–ª—É–≥–µ: "${skillName}"\n\n(–í –ø–æ–ª–Ω–æ–π –≤–µ—Ä—Å–∏–∏ –∑–¥–µ—Å—å –æ—Ç–∫—Ä–æ–µ—Ç—Å—è —á–∞—Ç)`);
    }
    
    console.log("–ü—Ä–æ—Å—Ç–∞—è –≤–µ—Ä—Å–∏—è Umeyka –∑–∞–≥—Ä—É–∂–µ–Ω–∞!");
  </script>
</body>
</html>
